<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Voting Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="assets/styles/app.css" rel="stylesheet">
  </head>
  <body>
    <div class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Voting</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li class="active">
              <a href="/">Home</a>
            </li>
            <li class="hide">
              <a href="/admin">Admin</a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="/signup">Sign up</a>
            </li>
            <li>
              <a href="/login">Login</a>
            </li>
            <li class="hide">
              <p class="navbar-text">Hello</p>
            </li>
            <li class="hide">
              <a href="/settings">
                <span class="glyphicon glyphicon-cog"></span>
              </a>
            </li>
            <li class="hide">
              <a href="">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <header class="hero-unit" id="banner">
      <div class="container">
        <div>
          <h1>Voting</h1>
          <p class="lead">Create custom polls with live results.</p>
          <a href="/signup">
            <button class="btn btn-lg btn-success main-signup">Sign Up</button>
          </a>
        </div>
        <div class="hide">
          <h1>Dashboard</h1>
          <p class="lead">What would you like to do today?</p>
          <button class="btn btn-lg btn-success">New Poll</button>
          <button class="btn btn-lg btn-primary">My Polls</button>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-lg-12 home">
          <div class="col-lg-4">
            <i class="fa fa-bolt"></i>
            <h2>Live Results</h2>
            <p>Live graphs show your poll results immediately in an easy to understand format. One graph will not provide the whole picture, that's why we provide multiple graph types to better describe your results.</p>
          </div>
          <div class="col-lg-4">
            <i class="fa fa-globe"></i>
            <h2>Works Everywhere</h2>
            <p>Traditional desktop computers now represent only 30% of Internet traffic. Your poll must work on the tablets, smart phones, netbooks and notebooks that your visitors are using. Our responsive designs do just that.</p>
          </div>
          <div class="col-lg-4">
            <i class="fa fa-facebook"></i>
            <h2>Social Integration</h2>
            <p>Free integrated facebook or traditional comments allow your poll voters to provide immediate feedback and discuss results. Social share buttons encourage your poll voters to help spread the word.</p>
          </div>
        </div>
        <div class="col-lg-12 signup-form">
          <form id="signup" name="signup">
            <div class="form-group">
              <label for="email">Enter your email address.</label>
              <input class="form-control" id="email" name="email" placeholder="john.smith@example.com" required>
            </div>
            <div class="form-group">
              <label for="password">Enter your desired password.</label>
              <input class="form-control" id="password" name="password" placeholder="password" type="password" required>
            </div>
            <div class="form-group">
              <label for="password_confirmation">Confirm your password.</label>
              <input class="form-control" id="password_confirmation" name="password_confirmation" placeholder="password" type="password" required>
            </div>
            <div class="form-buttons">
              <button class="btn btn-success" type="submit">Submit</button>
            </div>
          </form>
        </div>
        <div class="col-lg-12 login-form">
          <form id="login" name="login">
            <div class="form-group">
              <label for="email">Enter your email address.</label>
              <input class="form-control" id="email" name="email" placeholder="john.smith@example.com" required>
            </div>
            <div class="form-group">
              <label for="password">Enter your password.</label>
              <input class="form-control" id="password" name="password" placeholder="password" type="password" required>
            </div>
            <div class="form-buttons">
              <button class="btn btn-success" type="submit">Submit</button>
            </div>
          </form>
          <button class="btn btn-success btn-block" id="logout">Logout</button>
        </div>
        <div class="hide">
          <div class="col-lg-12">
            <div>
              <div class="col-lg-4"></div>
              <div class="col-lg-4 new-poll">
                <h2>New Poll</h2>
                <form id="newpoll" name="newpoll" novalidate>
                  <div class="form-group">
                    <label for="name">Name your poll.</label>
                    <input class="form-control" id="name" name="poll" placeholder="What is your favorite brand?" required>
                  </div>
                  <div class="form-group">
                    <label>Options</label>
                    <input class="form-control" placeholder="Coke" required>
                    <input class="form-control" placeholder="Pepsi" required>
                  </div>
                  <div class="form-buttons">
                    <button class="btn btn-default" type="button">More Options</button>
                    <button class="btn btn-success" disabled="disabled" type="submit">Submit</button>
                  </div>
                </form>
              </div>
              <div class="col-lg-4"></div>
            </div>
          </div>
          <div class="hide">
            <div class="col-lg-4"></div>
            <div class="col-lg-4 poll-posted">
              <h2>Congratulations!</h2>
              <p class="lead">Your poll has been posted to
                <a href=""></a>
              </p>
            </div>
            <div class="col-lg-4"></div>
          </div>
          <div class="vote hide">
            <div class="col-lg-4">
              <h1>{"name":""}?</h1>
              <p class="lead ng-binding">by</p>
            </div>
            <div class="col-lg-4">
              <form>
                <ul class="list-group"></ul><br>
                <button class="btn btn-lg btn-success vote" type="submit">Vote!</button>
              </form>
            </div>
            <div class="col-lg-4">
              <p id="comments">Sorry, no comments yet.</p>
            </div>
          </div>
        </div>
        <div class="results hide">
          <div class="col-lg-2"></div>
          <div class="col-lg-8 graph">
            <h1>{"name":""}</h1>
            <div class="chart-container">
              <canvas class="chart chart-bar col-lg-offset-2" id="bar"></canvas>
            </div>
          </div>
          <div class="col-lg-2"></div>
        </div>
        <div class="hide">
          <div class="col-lg-4"></div>
          <div class="col-lg-4 allpolls">
            <ul class="list-group"></ul>
          </div>
          <div class="col-lg-4"></div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Andrew Stucki</p>
      </div>
    </footer>
    <script src="assets/scripts/app.js"></script>
    <script>
      var session;
      $("#signup").submit(function(e){
        e.preventDefault();
        var data = {};
        $.each(this.elements, function(i, v){
          var input = $(v);
          data[input.attr("name")] = input.val();
          delete data["undefined"];
        });
        $.ajax({
          type: "POST",
          url: "/signup",
          data: JSON.stringify(data),
          contentType: "application/json",
          success: function(user){
            console.log(user);
            alert("Success!");
          }
        }).fail(function(err) {
            console.log(err);
            alert("Error!");
          });
      });

      $("#login").submit(function(e){
        e.preventDefault();
        var data = {};
        $.each(this.elements, function(i, v){
          var input = $(v);
          data[input.attr("name")] = input.val();
          delete data["undefined"];
        });
        $.ajax({
          type: "POST",
          url: "/session",
          data: JSON.stringify(data),
          contentType: "application/json",
          success: function(response){
            console.log(response);
            session = response;
            alert("Success!");
          }
        }).fail(function(err) {
            console.log(err);
            alert("Error!");
          });
      });

      $("#logout").click(function() {
        if (!session) return;
        $.ajax({
          type: "DELETE",
          url: "/session",
          headers: {
            "X-Voting-Session": session.token
          },
          success: function() {
            alert("Logged out!");
          }
        }).fail(function(err) {
          console.log(err);
          alert("Error logging out!");
        });
      });
    </script>
  </body>
</html>
